---
layout: post
title:  "(kein) echtes Sicherheitsbewusstsein von eQ-3 zu Homematic CCU Sicherheitslücken?"
datetime:   2019-07-09 20:00:00 MEST
last_modified_at: 2022-02-08 21:30:00 MET
author: 'psytester'
---

Ob eQ-3 als Hersteller der Homematic CCU das Thema Sicherheit wirklich ernst nimmt oder nur pressewirksam in einer Eigendarstellung darüber berichtet, wie zuletzt am 18.03.2019 die [eQ-3 Pressemitteilung](https://www.eq-3.de/aktuelles/newsreader/eq-3-schliesst-sicherheitsluecken-in-der-ccu.html) aka [CVE-2019-10119](https://nvd.nist.gov/vuln/detail/CVE-2019-10119) [CVE-2019-10120](https://nvd.nist.gov/vuln/detail/CVE-2019-10120) [CVE-2019-10121](https://nvd.nist.gov/vuln/detail/CVE-2019-10121) [CVE-2019-10122](https://nvd.nist.gov/vuln/detail/CVE-2019-10122), ~~ich weiß es nicht~~ ich glaube es durch meine bisherigen Erfahrungen nicht mehr.<br>
Ich als Melder von potentiellen Sicherheitslücken fühle mich jedenfalls zum Ende hin nicht ernst genommen.<br>
Auch die bisher schon bekannten 6 CVEs aus dem Jahr 2018, davon 3 schwere Sicherheitslücken, siehe Übersicht auf [www.cvedetails.com](https://www.cvedetails.com/vulnerability-list/vendor_id-17729/Eq-3.html), sind teilweise heute noch nicht behoben worden oder erst "frisch" nach einem Jahr.<br>
Leider teils nur oberflächlich geflickt....

# Chronologie der Kommunikation mit eQ-3

In Summe hatte ich anfänglich 16 Punkte an eQ-3 gemeldet.
Die ersten am 29.01.2019, der Rest verteilt bis zum 08.05.2019.

Am 19.03. habe ich zum aktuellen Stand der bisherigen Funde nachgefragt.

Am 19.03. habe ich auch an die BSI CERTBUND E-Mailadresse alle bisherigen Punkte und die passenden Exploits geschickt, mit der Hoffnung das es dann mehr Gewichtung beim Hersteller bekommt. eQ-3 hatte ja selber von einer "engen Zusammenarbeit mit dem BSI" geschrieben.<br>
Am 05.04. vom BSI final die Info erhalten, das auch ich eine Antwort von eQ-3 bis zum 08.04. erhalten soll.<br>
Am 08.04. wurde ich vom BSI gefragt, ob ich denn wie erwartet von eQ-3 kontaktiert wurde.<br>
Am 11.04. über das BSI noch mal nachgehakt, der 08. war ja ereignislos verstrichen.

Am 11.04. Abends von eQ-3 eine erste Antwort erhalten.<br>
Am 27.04. von eQ-3 einen "streng vertraulichen" Releaseplan erhalten, mit der Info dass dies eher eine große Ausnahme ist und der Hersteller eher kein Feedback gibt.<br>

Am 16.05. warnte das BSI über den CertBund Twitter Account [Mehrere tausend HomeMatic SmartHome-Systeme in Deutschland sind offen aus dem Internet erreichbar](https://www.twitter.com/certbund/status/1128955705451581440).<br>
Die Zahlen decken sich mit dem was ich über die Wochen hinweg kommuniziert habe.<br>
Dank meines [Vorschlags]( https://github.com/jens-maus/RaspberryMatic/pull/597) die einfache Erkennung der Systeme zu verschleiern, indem der HTTP Header "Server:" abgeschaltet wird, sind Homematic Systeme mit aktueller 2.47.10/3.47.10 und RaspberryMatic Firmeware nicht mehr so leicht auffindbar.
Am 16.07. listet [shodan](https://www.shodan.io/search?query=%22ise+GmbH+HTTP-Server+v2.0%22) 5388 offene Systeme und [censys](https://censys.io/ipv4?q=%22ise+GmbH+HTTP-Server+v2.0%22) nur 1576. Es waren mal weit über 8000 bei shodan.<br>
Am 25.06. wurden die Releases CCU3 3.47.10 und CCU2 2.47.10 veröffentlicht (für die CCU2 somit sogar 2 Wochen früher als geplant).

# Ende Gut, alles Gut?

Nein, leider nicht. Ein erstes Antesten hat gezeigt, das teilweise noch die selben Sicherheitslücken vorhanden sind und nun auch mindestens eine neue hinzugekommen ist ;-).<br>
Ich bereite nun die Veröffentlichung der bisherigen CVEs vor und zeige auf, wie man die Schwachstellen auch teilweise sehr gut kombinieren kann.<br>
Dem Hersteller werde ich die neue Schwachstelle melden und die unvollständig gefixte aufzeigen. Ich hoffe weiterhin, das es positiv und vor allem professioneller weitergehen wird.<br>
Wenn ich schon als Hobby Pentester das hinbekomme, weil die CCU ein gutes Übungsobjekt ist, um eine Schwachstelle mit einer anderen zu verbinden, was macht dann der professionelle digitale Einbrecher mit diesem Wissen?<br>

Am 15.07. habe ich meine Zusammenfassung für die mittlerweile 17 Punkte an eQ-3 und dem BSI verschickt.<br>
Und die Reise ging noch weiter...

Update am 17.09.2019:
# Weitere Chronologie der Kommunikation mit eQ-3
Ab dem 24.07. habe ich die CVEs nach und nach veröffentlicht<br>
<br>
Am 01.08. eQ-3 nochmalig kontaktiert, weil keinerlei Reaktion kam und dabei auch neue Schwachstellen gemeldet<br>
Am 05.08. hat mich das BSI gefragt, wie der Stand der Dinge ist, da die CVEs gesichtet wurden<br>
Am 16.08. hat das BSI bei eQ-3 ein weiteres mal nachgehakt<br>
Am 21.08. hat eQ-3 eine kurze Entschuldigungs E-Mail geschrieben mit der Aussicht einer neuen finalen Stellungnahme<br>
Am 26.08. kam die neue Stellungnahme und ein neuer Zeitplan<br>
Am 17.09. wurden die Releases CCU3 3.47.18 und CCU2 2.47.18 veröffentlicht und diese beheben die schlimmsten Punkte aus der Liste.<br>
<br>
Jetzt kann ich es ja verraten. Es hätte einen November Release geben sollen mit den nun vorliegenden Korrekturen, aber interessanterweise wurden diese ReGa Korrekturen allesamt vom Opensource RaspberryMatic Entwickler gefixt und auch meine Anregung das Accesslevel in der system.fn und programs.fn zu checken hat er umgesetzt, wodurch der Punkt 19 aka CVE-2019-14473 entschärft wurde.
Diese Arbeit hätte ich eindeutig von eQ-3 erwartet, aber sei's drum.

# Und Jetzt? Ende Gut, alles Gut?

Hmm...<br>
Der neue Zeitplan hat noch ein paar Punkte offen, wir werden also sehen. Ich kenne die angestrebten Zeiträume und teste dann nach.<br>
Aus Software Sicht wird sich also hoffentlich alles erledigen.<br>
<br>
Aber um es Spannend zu belassen, da kommt noch was ganz anderes.<br>
Bis dahin, abwarten....<br>
<br>
Update 10.10.2019:<br>
Die Qualität der Releases hat leider immer mal zu wünschen übrig. Der Release 2.47.18 mit den ganzen Sicherheitsupdates wurde am 19.09. sang und klanglos zurückgezogen, weil im HM-IP Java Prozess ein neuer Fehler vorhanden war, der die HM-IP Geräte Kommunikation gestört hat. Erst 5 Tage später gab es dann am 24.09. den 2.47.20 Release.<br>
Das selbe ist nun am 09.10. mit dem Release 3.47.18 passiert. Die korrigierte 3.47.22 kam erst am 23.10. raus.<br>
Ich kann es für die HM-IP Welt verstehen, aber Nutzer ohne HM-IP Geräte sind nicht betroffen.<br>
Funktionalität geht immer vor Sicherheit ?!? Ich wüsste auch nicht wie ich mich entschieden hätte, wenn das meine Software wäre. Aktuell konnte man jedenfalls kein CCU3 Update mit den Sicherheitsupdates für ganze 2 Wochen bekommen.<br>
<br>
Update 10.12.2019:<br>
Die Firmware 2.49.17 & 3.49.17 wurde released<br>
Nach vermehrten Problemmeldungen wurde für die CCU2 ein Tag später die 2.49.18 rausgebracht.<br>
ABER! Nun endlich hat die CCU2 einen neuen Linux Unterbau bekommen und ist in Teilen sogar deutlich neuer als die CCU3.<br>
<br>

# Aber Jetzt?!? Ende Gut, alles Gut?
Update 03.01.2020:<br>

Ich denke leider nein.<br>
Im September hatte ich eine E-Mail bekommen mit folgender Abschlussinformation:
```
Nach dem nächsten Release-Paket melden wir uns wieder gesammelt
zu den bis dahin gemeldeten Findings mit einer weiteren inhaltlichen und zeitlichen Einschätzung.
```
Heute ist der 3. Januar und seit dem Release am 10. Dezember hat sich eQ-3 leider nicht wie versprochen zurückgemeldet.<br>
Es sind nur noch fünf der Punkte (2, 4, 5, 7 & 15) aus der Liste unten offen, wobei nur Punkt Nr. 5 als sehr kritischer Fehler wichtig wäre zu korrigieren. Es sind nun mehr als 22 Monate vergangen und nichts ist passiert!<br>
<br>
Außerdem glaube ich, dass sich die Einstellung von eQ-3 nicht ändern wird, da ich vor Monaten eine Begegnung der ganz anderen Art hatte. Ich war auf der IFA und wollte mich bei der Gelegenheit mal persönlich vorstellen. Ich wollte nicht der unbekannte „böse Hacker“ sein und habe mit Herrn Grohmann, Vorstand der eQ-3 AG, das Gespräch gesucht. Ich habe ihn wohl auf dem falschen Fuß erwischt, anders kann ich mir das „ungeschminkte“ Gespräch nicht erklären. Von Einsicht keine Spur, eher die Gegenfrage warum ich auf dem „Marktführer“ rumhacke, die anderen Anbieter seine noch viel schlimmer. Die vielen Sicherheitsprobleme im ReGa Prozesse kennt er doch schon alle. Was ich machen will, wenn diese gefixt wurden, weil ich ja dann nichts mehr zum Auffinden habe. Das Gespräch dauerte sogar recht lange, war für mich in Summe aber absolut frustrierend. Ich würde mich nicht wundern, wenn diese Einstellung auf die untere Belegschaft „runter strahlt“.<br>
<br>
eQ-3 hat zum zukünftigen neuen „Connected Home over IP“ („CHIP“) Standard [seinen Standpunkt veröffentlicht](https://www.homematic-ip.com/downloads/hmip/content/pdf/chip_review_HmIP_kurz_200102.pdf) <Ironie=on> und natürlich gibt es nur einen Hersteller, der es richtig macht <Ironie=off>.<br>
```
[...]Homematic IP ist bis heute das einzige System, dessen Protokoll-, IT- und Datensicherheit vom VDE zertifiziert ist.
```
Aber bei den Aussagen bitte auch mal an die eigene Nase fassen!
```
[...]Bislang ist Security eher eine deutliche Schwäche der sogenannten Smart Home „Standards“. 
[...]Die meisten heutigen Smart Home Systeme haben massive Sicherheitslücken. Wie soll ein neues System sicher sein, wenn es unsichere Produkte früherer Technologien einbindet?
```

# Und Jetzt?!? Fertig mit den Problemen?
Update 14.05.2020:<br>

Für die seit 2018 bekannte Schwachstelle [CVE-2018-7297](https://atomic111.github.io/article/homematic-ccu2-remote-code-execution) hatte eQ-3 im August 2019 diese Antwort gegeben:
```
Die Schwachstellen in der CCU3 sind bereist behoben. 
Der gleiche Ansatz wie bei der CCU3 führte bei der CCU2 dazu , dass die Partnererweiterungen (z.B. Penzler-App) nicht mehr funktionierten.
Daher ist die Behebung evtl. nicht wirtschaftlich sinnvoll lösbar, dies muss für das Release im 1. Quartal 2020 geprüft werden.
```
Naja...<br>
Q1/2020 ist jetzt im Mai 2020 schon länger vorbei.<br>
Aber Zeit = Geld wurde wegen [CVE-2019-9582](https://psytester.github.io/CVE-2019-9582/) aufgewendet um ein großes Update der CCU2 auf eine deutlich neuer Build Root und BusyBox Version durchzuführen. Dabei wurde auch gleich `curl` mitgebracht, was viele freut aber auch zu [Problemen führte](https://homematic-forum.de/forum/viewtopic.php?p=549683#p549683).<br>
Und der Kernel wurde erneuert, natürlich ohne "Absprache"/Test mit den AddOn Projekten und schwupps liefen in [CUxD die FTDI USB Sticks nicht mehr](https://homematic-forum.de/forum/viewtopic.php?p=548420#p548420).

# Und ?!?
Update 09.02.2021:<br>

Wir haben aktuell die CCU2 Firmware 2.55.10<br>
eQ-3 bleibt sich treu und die nun seit 2018 öffentlich bekannte Schwachstelle in der CCU2 [CVE-2018-7297](https://atomic111.github.io/article/homematic-ccu2-remote-code-execution) ist auch 3 Jahre später weiterhin vorhanden.<br>
Auch entgegen dieser Behauptung im [Homematic Forum](https://homematic-forum.de/forum/viewtopic.php?f=26&t=60281#p597468) --> *Nein* diese Lücke ist nicht seit der Firmware 2.47.18 gefixt!<br>
Der Forenbeitrag zeigt auch gleich ein weiteres mal, das die theoretische Bedrohung tatsächlich vorhanden ist. Der Benutzer wurde scheinbar von seiner eigenen CCU ausgeschlossen.<br>
Es wäre SO EINFACH in der lighttpd proxy.conf wie auf der CCU3 den Port 80 und 443 mit einem url.access-deny abzusichern.
```
  $HTTP["url"] =~ "^/.*\.(exe|oxml|hssml).*" {
    $HTTP["remoteip"] !~ "........" {
      url.access-deny = ( "" )
    }
  }
```

# Na ?!?
Update 08.02.2022:<br>

Wieder ist ein Jahr vergangen und wir haben seit Jan. 2022 die CCU2 Firmware 2.61.7<br>
Die Schwachstelle [CVE-2018-7297](https://atomic111.github.io/article/homematic-ccu2-remote-code-execution) in der CCU2 ist weiterhin vorhanden.<br>

Diese Seite mag ich gar nicht mehr weiter pflegen!

## Die Liste der gemeldeten Punkte
<div style="overflow-x:auto;">
<table border="1">
  <thead>
    <tr>
      <th>Punkt</th> <th>Tag der Meldung</th> <th>Problem</th> <th>CCU2/CCU3?</th> <th>Resultat bei einem Angriff</th> <th>Ergebnis oder Lösung am 08.08.</th> <th>Ergebnis oder Lösung am 17.09.</th> <th>Ergebnis oder Lösung am 10.12.</th>
    </tr>
  </thead>
  <tfoot>
    <tr>
      <th>Punkt</th> <th>Tag der Meldung</th> <th>Problem</th> <th>CCU2/CCU3?</th> <th>Resultat bei einem Angriff</th> <th>Ergebnis oder Lösung am 08.08.</th> <th>Ergebnis oder Lösung am 17.09.</th> <th>Ergebnis oder Lösung am 10.12.</th>
    </tr>
  </tfoot>
  <tbody>
    <tr><td>1</td><td>29.01.2019</td><td>veralteter lighttpd Webserver</td><td>nur CCU2</td><td>Denial of Service</td><td>Leider noch kein Update. Mittlerweile als <a target="_blank" href="https://psytester.github.io/CVE-2019-9582/">CVE-2019-9582</a> veröffentlicht</td><td>N.A.</td><td>mit 2.49.17 gefixt</td></tr>
    <tr><td>2</td><td>29.01.2019</td><td>veraltetes Oracle Java 8u121</td><td>nur CCU2</td><td>noch kein konkretes</td><td>mit Release 2.47.10 Update auf letztes freies Oracle Java 8u201. Nach dem Update ist vor dem Update, somit wieder veraltet</td><td>N.A.</td><td>N.A.</td></tr>
    <tr><td>3</td><td>29.01.2019</td><td>stark veraltetes Embedded Linux Build Root und BusyBox</td><td>nur CCU2</td><td>noch kein konkretes</td><td>Teil der mittlerweile als <a target="_blank" href="https://psytester.github.io/CVE-2019-9582/">CVE-2019-9582</a> veröffentlichen Schwachstelle</td><td>N.A.</td><td>mit 2.49.17 gefixt</td></tr>
    <tr><td>4</td><td>13.02.2019</td><td>Keine generelle Login SessionID Absicherung von CGI und HTML Seiten</td><td>beide</td><td>* Denial of Service<br>* Uncontrolled Resource Consumption<br>* File Modification / Deletion</td><td>* eQ-3 ist nicht für die AddOns verantwortlich, liefert jedoch den Unterbau und der enthält derzeit noch eine veraltete Node.js Version<br>* eQ-3 eigene Seiten bleiben ungeschützt<br>Ist es eine CCU2 oder CCU3? http://myip/upnp/basic_dev.cgi<br>Installierte Firmware abfragen für weitere Angriffe: http://myip/api/backup/version.cgi<br>* Mediola NEO Server v2.4.5 ist nur teilweise gelöst, alle Details als <a target="_blank" href="https://psytester.github.io/CVE-2019-13030/"></a> veröffentlicht<br>* Cloudmatic noch nicht in der Firmware, jedoch schon vom AddOn Hersteller seit Ende Mai mit einem Hotfix vorbereitet, siehe <a target="_blank" href="https://github.com/EasySmartHome/CloudMatic-CCUAddon/issues/8">Github Issue #8</a>, Details als <a target="_blank" href="https://psytester.github.io/CVE-2019-9584/">CVE-2019-9584</a> veröffentlicht</td><td>N.A.</td><td>N.A.</td></tr>
    <tr><td>5</td><td>28.02.2019</td><td>ReGaHss nicht dokumentierter interner Befehl system.Exec()</td><td>beide</td><td>Remote Code Execution</td><td>Keine befriedigende Lösung. Bei Recherchen im Nachgang sogar schon seit Feb. 2018 bekannt als <a target="_blank" href="https://atomic111.github.io/article/homematic-ccu2-remote-code-execution">CVE-2018-7297</a> veröffentlichte Schwachstelle</td><td>N.A.</td><td>N.A.</td></tr>
    <tr><td>6</td><td>28.02.2019</td><td>Aufruf der /index.htm Seite erzeugt SessionID</td><td>beide</td><td>Denial of Service</td><td>Gelöst mit Release 2.41.8 und 3.43.15.<br>Wurde schon vorher durch anderen Pentester gefunden und unter den CVEs <a target="_blank" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-10119">CVE-2019-10119</a>, <a target="_blank" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-10120">CVE-2019-10120</a> und <a target="_blank" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-10121">CVE-2019-10121</a> veröffentlicht. Wurde am 18.03. Pressewirksam ausgerollt</td><td>schon gefixt</td><td>schon gefixt</td></tr>
    <tr><td>7</td><td>28.02.2019</td><td>Process Fuzzing auf die URI /xml-api</td><td>beide</td><td>noch kein konkretes</td><td>soll eventuell in kommenden Versionen behoben werden</td><td>N.A.</td><td>N.A.</td></tr>
    <tr><td>8</td><td>13.03.2019</td><td>JSON API User.getUserPWD ohne gültige SessionID</td><td>beide</td><td>Passwort Hash auslesen</td><td>Wurde parallel schon von anderem Pentester gefunden und als <a target="_blank" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9727">CVE-2019-9727</a> veröffentlicht.<br>Mit Release 2.41.9 und 3.43.16 nur vom LEVEL NONE auf LEVEL USER gehoben und somit konnte zumindest ein Account mit Level User das Admin Passwort weiterhin auslesen.<br>Erst seit Release 2.47.10 / 3.47.10 wurde User.getUserPWD durch User.hasUserPWD ersetzt und somit final gefixt.</td><td>schon gefixt</td><td>schon gefixt</td></tr>
    <tr><td>9</td><td>12.04.2019</td><td>expliziter Hinweis auf schon bekannte CVEs</td><td>beide</td><td>* Directory Traversal<br>* Arbitrary File Write<br>* Remote Code Execution</td><td>Alte Lücken wie <a target="_blank" href="https://www.cvedetails.com/cve/CVE-2018-7297/">CVE-2018-7297</a> und auch neue Lücken wie <a target="_blank" href="https://www.cvedetails.com/cve/CVE-2019-9726/">CVE-2019-9726</a> sind weiterhin nicht gefixt</td><td><a target="_blank" href="https://www.cvedetails.com/cve/CVE-2019-9726/">CVE-2019-9726</a> ist mit 2.47.18 & 3.47.18 gefixt</td><td>schon gefixt</td></tr>
    <tr><td>10</td><td>12.04.2019</td><td>JSON API Interface.getMetadata / Interface.setMetadata und Interface.removeMetadata ohne gültige SessionID</td><td>beide</td><td>Meta Daten auslesen, (korrupt) verändern, löschen</td><td>Seit Release 2.47.10 und 3.47.10 gefixed. Als <a target="_blank" href="https://psytester.github.io/CVE-2019-9585/">CVE-2019-9585</a> veröffentlicht</td><td>schon gefixt</td><td>schon gefixt</td></tr>
    <tr><td>11</td><td>07.05.2019</td><td>Erzeugung einer SessionID ohne gültigen Login</td><td>beide</td><td>* Escalation of Privileges<br>* Denial of Service<br>* Information Disclosure </td><td>Mit Release 2.47.10 und 3.47.10 nur für wenige Seitenaufrufe gefixed, der große Rest ist noch angreifbar. Als <a target="_blank" href="https://psytester.github.io/CVE-2019-9583/">CVE-2019-9583</a> veröffentlicht</td><td>mit 2.47.18 & 3.47.18 gefixt</td><td>schon gefixt</td></tr>
    <tr><td>12</td><td>07.05.2019</td><td>Ohne gültigen Login kann man die Systemprotokoll Einträge löschen</td><td>beide</td><td>* Escalation of Privileges</td><td>Noch ungelöst. Als Teilpunkt des <a target="_blank" href="https://psytester.github.io/CVE-2019-14475/">CVE-2019-14475</a> veröffentlicht</td><td>mit 2.47.18 & 3.47.18 gefixt</td><td>schon gefixt</td></tr>
    <tr><td>13</td><td>07.05.2019</td><td>Ohne gültigen Login kann man die Servicemeldungen lesen</td><td>beide</td><td>* Escalation of Privileges</td><td>Noch ungelöst. Als Teilpunkt des <a target="_blank" href="https://psytester.github.io/CVE-2019-14475/">CVE-2019-14475</a> veröffentlicht</td><td>mit 2.47.18 & 3.47.18 gefixt</td><td>schon gefixt</td></tr>
    <tr><td>14</td><td>07.05.2019</td><td>Ohne gültigen Login kann man User teilweise einrichten</td><td>beide</td><td>* Escalation of Privileges</td><td>Noch ungelöst. Als Teilpunkt des <a target="_blank" href="https://psytester.github.io/CVE-2019-14475/">CVE-2019-14475</a> veröffentlicht</td><td>mit 2.47.18 & 3.47.18 gefixt</td><td>schon gefixt</td></tr>
    <tr><td>15</td><td>08.05.2019</td><td>Prozess Fuzzing im ReGaHss Process für Call() ExecEnum() Methoden</td><td>beide</td><td>noch kein konkretes</td><td>zumindest im Logfile entstehen Einträge wegen fehlerhafter Aufrufe</td><td>N.A.</td><td>N.A.</td></tr>
    <tr><td>16</td><td>08.05.2019</td><td>ReGaHss Prozess Absturz bei einem POST Request mit einem leeren Call("")</td><td>nur CCU3</td><td>Denial of Service</td><td>Noch ungelöst. Als <a target="_blank" href="https://psytester.github.io/CVE-2019-14474/">CVE-2019-14474</a> veröffentlicht</td><td>mit 2.47.18 & 3.47.18 gefixt</td><td>schon gefixt</td></tr>
    <tr><td>17</td><td>15.07.2019</td><td>Keine Session Invalidierung/Löschung beim Abmleden im Release 2.47.10/12 und 3.47.10</td><td>beide</td><td>mit CVE-2019-9726 die SessionID auslesen und WebUI betreten</td><td>Ich habe keine Lust dafür einen CVE zu erstellen, zumal die Lücke mit dem Release 2.47.15 und 3.47.15 sogar schon wieder gefixt wurde</td><td>mit 2.47.18 & 3.47.18 gefixt</td><td>schon gefixt</td></tr>
    <tr><td>18</td><td>01.08.2019</td><td>Ohne gültigen Login kann man interne HM Scripte/Programme deaktivieren, manipulieren und löschen</td><td>beide</td><td>* Escalation of Privileges</td><td>Noch ungelöst. Als Teilpunkt des <a target="_blank" href="https://psytester.github.io/CVE-2019-14475/">CVE-2019-14475</a> veröffentlicht</td><td>mit 2.47.18 & 3.47.18 gefixt</td><td>schon gefixt</td></tr>
    <tr><td>19</td><td>01.08.2019</td><td>Das Rechte Konzept der CCU besitzt keine echte Mandantenfähigkeit. Ein Gast und User Account kann viele Admin Operationen durchführen</td><td>beide</td><td>mit CVE-2019-9726 die SessionID auslesen und WebUI betreten</td><td>Noch ungelöst. Als <a target="_blank" href="https://psytester.github.io/CVE-2019-14473/">CVE-2019-14473</a> veröffentlicht</td><td>mit 2.47.18 & 3.47.18 gefixt</td><td>schon gefixt</td></tr>
    <tr><td>20</td><td>26.08.2019</td><td>Neue Variante einer Remote Code Execution bei bestimmten HTTP POST Requests</td><td>beide</td><td>Remote Code Execution</td><td>-----</td><td>Als <a target="_blank" href="https://psytester.github.io/CVE-2019-16199/">CVE-2019-16199</a> veröffentlicht, gefixt mit 2.47.18 & 3.47.18</td><td>schon gefixt</td></tr>
    <tr><td>21</td><td>12.05.2020</td><td>Nächste Variante einer Remote Code Execution durch AutoLogin Funktion nach Ersteinrichtung, als <a target="_blank" href="https://psytester.github.io/CVE-2020-12834/">CVE-2020-12834</a> veröffentlicht</td><td>beide</td><td>Remote Code Execution</td><td>-----</td><td>-----</td><td>-----</td></tr>
  </tbody>
</table>
</div>

Sollte irgendwann in der Zukunft nach nun schon mehr als 22 Monaten die öffentlich als [CVE-2018-7297](https://atomic111.github.io/article/homematic-ccu2-remote-code-execution) bekannte RCE Angriffsmöglichkeit in der CCU2 gefixt werden, sind User mit bestimmten zusätzlichen AddOns weiterhin angreifbar.<br>
[CVE-2018-7297](https://atomic111.github.io/article/homematic-ccu2-remote-code-execution) macht sich hier zu nutze, dass der nicht dokumentierte interne Befehl system.Exec() im ReGaHss Prozess auf dem Port 80 ungeschützt nutzbar ist. Die Funktion ist unter Homematic Besitzers schon seit Jahren bekannt und wird in lokalen Skripten genutzt. Leider kann dies auch ein Angreifer Remote ausnutzen.

eQ-3 ist zwar nicht für die AddOn Hersteller verantwortlich. Da es aber keine grundlegende Absicherung in der CCU gibt, existieren out-of-the-box zusätzliche Angriffsvektoren und somit z.B. weitere simple RCE Angriffsmöglichkeiten.<br>
Auf meinen Hinweis zur Remote Code Execution durch Addon Installationen kam im August 2019 die Antwort: `Eine Behebung ist derzeit noch nicht eingeplant.`<br>
Speziell zum CUxD AddOn kam im August 2019 diese Antwort: `Die CuxD ist ein Addon, dies wird  mit CuxD abgestimmt, da die Behebung der Schwachstelle von deren Seite ausgeführt werden muss.`<br>
<br>
Die ersten fünf Einträge in der nachfolgenden Tabelle kann man für RCE Angriffe ausnutzen, ohne Login: 

| AddOn| CVE |
|--- | --- |
| 'CUxD' version 2.3.4 | [CVE-2019-14985](https://psytester.github.io/CVE-2019-14985/) |
| 'XML-API' version 1.2.0 | [CVE-2019-14984](https://psytester.github.io/CVE-2019-14984/) |
| 'ScriptParser' version 1.8 | [CVE-2019-18937](https://psytester.github.io/CVE-2019-18937/) |
| 'E-Mail' version 1.6.8.c | [CVE-2019-18938](https://psytester.github.io/CVE-2019-18938/) |
| 'HM-Print' version 1.2a | [CVE-2019-18939](https://psytester.github.io/CVE-2019-18939/) |
| 'Mediola NEO Server' version 2.4.5 | [CVE-2019-13030](https://psytester.github.io/CVE-2019-13030/) |
| 'CloudMatic' | [CVE-2019-9584](https://psytester.github.io/CVE-2019-9584/) |

Kein zusätzliches AddOn, aber eine weitere RCE Möglichkeit ohne Logindaten eingeben zu müssen:<br>
Inspiriert durch [CVE-2019-15850](https://noskill1337.github.io/homematic-ccu3-remote-code-execution), wo die JSON API Methode `ReGa.runScript` nach dem manuellen Login genutzt wird ist der weitere Angriffsvektor in [CVE-2020-12834](https://psytester.github.io/CVE-2020-12834/) entstanden. Denn es wird die AutoLogin Funktion in der Ersteinrichung aktiviert. Durch dieses AutoLogin wird beim Aufruf der WebUI automatisch eine gültige SessionID erzeugt, die wir in der JSON API Methode `ReGa.runScript` nutzen. Natürlich kann man dann noch ganz andere Dinge anstellen in der WebUI.

# Disclaimer

The information provided is released "as is" without warranty of any kind. The publisher disclaims all warranties, either express or implied, including all warranties of merchantability. No responsibility is taken for the correctness of this information.
In no event shall the publisher be liable for any damages whatsoever including direct, indirect, incidental, consequential, loss of business profits or special damages, even if the publisher has been advised of the possibility of such damages.

The contents of this advisory are copyright (c) 2019, 2020 by psytester and may be distributed freely provided that no fee is charged for this distribution and proper credit is given.
